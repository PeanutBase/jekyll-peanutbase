---
layout: default
title: ArachisMine trait keyword search
---

<script type="text/javascript" src="./js/graphql.js"></script>
<script type="module" src="./js/web-components.bundled.js"></script>

<h2>ArachisMine Trait Keyword Search</h2>

<div class="uk-container">
  <!-- the custom trait search element -->
  <lis-trait-search-element id="trait-search"></lis-trait-search-element>
</div>

<!-- set the search function by property because functions can't be set as attributes -->
<script type="text/javascript">
  const traitQuery = `
    query Query($name: String!, $start: Int, $size: Int) {
      traits(name: $name, start: $start, size: $size) {
        id
        name
        description
      }
    }
  `;

  // the search function given to the LIS trait search webcomponent
  function getTraits(searchData, page, {abortSignal}) {
    const name = searchData['query'];
    const pageSize = 10;
    const start = (page-1)*pageSize;
    const variables = {name, start, size: pageSize+1};
    // returns a Promise that resolves to an array of Trait objects the trait search
    // webcomponent knows how to parse: {name: string, description: string}[]
    return graphqlQuery(uri, traitQuery, variables, abortSignal)
      .then(({data}) => {
        const hasNext = pageSize+1 === data.traits.length;
        // remove the lookahead result
        if (hasNext) data.traits.pop();
        for (var trait of data.traits) {
          trait.name = '<a href="https://mines.legumeinfo.org/arachismine/report.do?id=' + trait.id + '" target="_blank">' + trait.name + '</a>';
          if (trait.description == null) trait.description = '';
        }
        // construct the expected paginated results object
        const paginatedResults = {
          hasNext,
          results: data.traits,
        };
        return paginatedResults;
      }
    );
  }

  const traitSearchElement = document.getElementById('trait-search');
  traitSearchElement.searchFunction = getTraits;
</script>

